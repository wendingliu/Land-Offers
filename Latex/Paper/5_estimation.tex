%!TEX root = paper.tex
\subsection{Settings for calibration and estimation}
\label{settings for estimation}
I calibrate the parameter of capital income share $\alpha$ in the model,
then use the method of simulated moments (MSM)
\citep{pakes1989simulation, mcfadden1989method,
    gourieroux1996simulation}
to estimate the parameter of governments' revenue share $\beta$
and the scale parameter $\sigma$ of the distribution of the unobserved term in production cost.


More specifically, I choose the capital income share
$\alpha = 0.5$ according to \cite{zhu2012understanding}
and \cite{brandt2008growth}. I also do estimations
for $\alpha = 0.33$ and $0.67$, which generate similar estimates
of $\beta$ and $\sigma$. This may indicate a potential identification
problem for $\alpha$.

I bound the parameters space as $\beta \in [0, 2]$ and $\sigma \in (0, 1000]$ and perform
the initial grid search for parameters. The parameters space is large
enough since two times of yearly output of firms is huge
as the city governments' revenue share,
and $\sigma$ should not be too large to make the location choice irrelevant
of the city governments' land-selling strategies.

I also specify the action space of cities for the game of attracting firm $i$ as
$[p^{i}_{min}, ~p^{i}_{max}]$, where $p^{i}_{min} = \max\{0, ~p^{i}_{obs} - 2000\}$,
$p^{i}_{max} = p^{i}_{obs} + 2000$, $p^{i}_{obs}$ is the observed
land price offered to firm $i$ in data. $p^{i}_{min}$ is used to roughly characterize
the participation constraints of cities since the cities will not sell the land to the firm
if the cost of land cannot be covered by the land-selling revenue and fiscal revenue.
And $p^{i}_{max}$ is used to characterize the participation constraint of the firm since
if the land price (a part of production cost) is too high, the firm will suffer loss.
The action space is neither too large nor too small
(2000 is roughly one-third of the range of observed land prices).
See \hyperref[sec:robustness checks 2]{Appendix B.2} for robustness checks of other settings
of the action space.

To estimate $\beta$ and $\sigma$, I need to
solve the Bertrand pricing games for each firm under different values of parameters.
All the parameters and variables (inputs) needed for solving the
Bertrand Game $\langle \mathbf{C}_{i}, (S_{ik}), (v_{ik}) \rangle$ are listed
in \Cref{table: inputs}:

\input{\tables/estimation_inputs.tex}

If I have all the inputs defined in \Cref{table: inputs}, the equilibrium price
vector $p_i$ can be solved by using \Cref{gauss seidel}
for all observations (all firm $i$) in data.
Thus, I need to specify $\mathbf{C}_i$
(the choice set of the firm) in \Cref{table: inputs} explicitly to obtain the parametric model.

I simulate $\mathbf{C}_{i}$ by repeatedly drawing
$|\mathbf{C}_{i}|$ cities randomly from ten cities that are nearest
to the city where the firm lands in data (the observed chosen city).\footnote{
    By ``nearest'' I mean the ten cities which have
    the shortest straight-line distances (between city centers) to the chosen city.
    The chosen city is included in the ten cities. }

To fully specify the generating process of the choice set,
the size of the set $|\mathbf{C}_i|$ has to be determined.
In \Cref{sec:model} I set $|\mathbf{C}_i| = l(Y_i)$,
and $l(Y_i)$ is defined explicitly here:
\begin{equation}
    l(Y_i) =
    \begin{cases}
        3 & \text{if $Y_i \leq 33rd \text{ percentile of } Y$} \\
        4 & \text{if $33rd \text{ percentile of } Y
        < Y_i \leq 67th \text{ percentile of } Y$}             \\
        5 & \text{if $Y_i > 67th \text{ percentile of } Y$}    \\
    \end{cases}
    \label{size of choice set}
\end{equation}
In other words, there are $33\%$ firms that have 3, 4, and 5 candidate cities respectively.
And what I assume here is the number of candidate cities of a firm is increasing
in the scale (output level) of a firm. This is consistent with the observation
that large firms
always have more political resources and are more valuable in the eyes of city governments,
and are often attracted by more city governments. I use five as an upper bound for the number
of candidate cities based on the observation that the political resources of
a firm to deal with city governments are limited.\footnote{
    It's difficult if not impossible for researchers to know the exact number of cities attracting
    each firm, thus, I choose the numbers in \eqref{size of choice set} based on the media coverage
    of location choices of some large firms.
    For example, four cities Zhengzhou, Kaifeng, Nanyang, Hebi
    in Henan province tried to attract Foxconn, a Taiwanese multinational electronics contract
    manufacturer
    to build its factory in 2010 (\url{http://www.chinanews.com.cn/cj/2010/07-22/2419622.shtml}).
    Five cities (Xi'an, Beijing, Chongqing, Wuxi, Suzhou) were reported to attract Samsung,
    a Korean multinational manufacturing conglomerate to build its factory in 2012
    (\url{http://jingji.cntv.cn/20120417/109763.shtml}).
}
For robustness checks, I also do estimation under the two settings
that (\RomanNumeral{1}) one-half of the firms have
3 candidate cities, the other half of the firms have 4 candidate cities.
(\RomanNumeral{2}) one-half of the firms have 4 candidate cities,
and the other half of the firms have 5 candidate cities
respectively, and the results are reported in
\hyperref[sec:robustness checks 1]{Appendix B.1}.


\subsection{Moment conditions}
Next, I construct the MSM estimator for the parameter $\beta$ and $\sigma$.
I define all the information of firm $i$ as $Q_i \equiv \{Y_i, T_i, B_i\}$.
All the parameters are denoted by $\theta = (\alpha, \beta, \sigma)$,
and the true parameters are denoted by $\theta_0$.
From the discussion in \Cref{sec:model}
it is known that if the distribution of the choice set $\mathbf{C}_i$ is given, the distribution of
land price at NE for firm $i$ will also be determined,
thus the expectation of the land price will be
determined. I define $x_i \equiv [p_i, p_i^2]^{'}$,\footnote{
    $p_i$ is scaled by 10,000 for estimation since $p_{max}=6001.56$ in data.}
and denote the conditional first and second-order moments of land price
by $h(x_i; \theta_0) \equiv E(x_i|Q_i;\theta_0)$.
By the definition of conditional land price, I have:
\begin{equation}
    E[x_i - h(Q_i; \theta_0)|Q_i] = 0
\end{equation}

Since the structural residual $x_i - h(Q_i; \theta_0)$ is orthogonal to any function of $Q_i$,
I choose
the instrument variables vector $Z_i = [1, Y_i, T_i, Y_i \times T_i]^{\prime}$
for simplicity.\footnote{$Y_i$ and $T_i$ are also scaled to the interval $[0, 1]$ for estimation.}
The moment conditions are:
\begin{equation}
    E[Z_i \otimes \big(x_i - h(Q_i; \theta_0)\big)] = 0
\end{equation}
where the expectation of Kronecker product is zero vector, i.e., each IV is orthogonal
to the two-by-one structural residuals vector.

Since calculating the theoretical moment $h(Q_i; \theta)$ is computationally expensive,\footnote{
    For example, if each firm only has three candidate cities,
    then to calculate the conditional moments for one firm at any given parameters $\theta$,
    I need to solve $\binom{10}{3} = 120$ games.}
I use the simulated moment
$\frac{1}{S} \sum\limits_{s=1}^{S} \tilde{h}(Q_i, \mathbf{C}^{s}_{i}; \theta)$ to replace
$h(Q_i; \theta_0)$,
where
$\tilde{h}(Q_i, \mathbf{C}^{s}_{i}; \theta)\equiv E(x_i|\mathbf{C}^{s}_{i}, Q_i;\theta_0)$,
the number of simulations $S=10$,
and $\mathbf{C}^{s}_{i}$ is randomly drawn
as described in \Cref{settings for estimation}.
The MSM estimator is defined by:
\begin{align}
     & \hat{\theta} = \argmin_{\theta}
    \Big(\sum\limits_{i=1}^{N}Z_i \otimes \big(x_i - \frac{1}{S}
    \sum\limits_{s=1}^{S} \tilde{h}(Q_i, \mathbf{C}^{s}_{i}; \theta)\big)\Big)^{'}
    W
    \Big(\sum\limits_{i=1}^{N}Z_i \otimes \big(x_i - \frac{1}{S}
    \sum\limits_{s=1}^{S} \tilde{h}(Q_i, \mathbf{C}^{s}_{i}; \theta)\big)\Big) \\
     & s.t. \quad \theta = (\alpha_0, \beta, \sigma),
    ~0 \leq \beta \leq 10,  ~0 < \sigma \leq 1000 \nonumber
    \label{msm criteria}
\end{align}
where $\alpha_0$ is the calibrated $\alpha$, and $W$ is the weighting matrix described in
\Cref{numerical_algorithm}. As the estimation results in \Cref{sec:results} show,
the constraints of $\beta$ and $\sigma$ are not binding at the solution.



\subsection{Numerical algorithm for estimation}
\label{numerical_algorithm}
In this section, I discuss the numerical algorithm used to
estimate $\beta$ and $\sigma$.
Showing that a global minimum of the MSM objective is found in nonlinear models
is generally very difficult or impossible \citep{iskhakov2021effects}, but I try to reach the
global minimum as close as possible by combining the grid search and Quasi-Newton algorithm.

I do a two-stage MSM estimation.
As mentioned in the last section, I calibrate $\alpha$ to 0.33, 0.5, and 0.67 respectively.
For each $\alpha$,
in the first stage of estimation,
I set the weighting matrix to the identity matrix.
Next I calculate the MSM objective for all the $(\beta, \sigma)$ pairs
on the grids $\{0, 0.1, \dots, 2.0\} \times \{100, 200, \dots, 1000\}$ and find the
$(\tilde{\beta}, \tilde{\sigma})$ with the smallest MSM objective,
which should be near the global minimizer.
Then I use Quasi-Newton (L-BFGS) algorithm to do a finer search of the two parameters starting from
$(\tilde{\beta}, \tilde{\sigma})$ to get the first stage estimates
$(\hat{\beta}_0, \hat{\sigma}_0)$.

To do the second-stage estimation, I update the weighting matrix $W$ as the
sample analog of $\{\Var[ Z_i \otimes \big(x_i -
        h(Q_i; \hat{\theta}_0)\big)] +
    \frac{1}{S}\Var[ Z_i \otimes \big(\tilde{h}(Q_i, \mathbf{C}^{s}_{i}; \hat{\theta}_0) -
        h(Q_i; \hat{\theta}_0)\big)]\}^{-1}$, where
$\hat{\theta}_0 = (\alpha_0, \hat{\beta}_0, \hat{\sigma}_0)$, and I use the average of 30
simulations to approximate the theoretical moments
$h(Q_i; \hat{\theta}_0)$ for each observation $i$.
I use Quasi-Newton (L-BFGS) algorithm to search the second-stage estimates $(\hat{\beta}, \hat{\sigma})$,
which minimizes the new criteria function with the updated $W$,
staring from the first stage estimates $(\hat{\beta}_0, \hat{\sigma}_0)$.

I treat $W$ as the optimal weighting matrix,
and the estimated asymptotic covariance matrix of the second-stage estimates
are $\frac{1}{N} (\hat{D}^{'}W\hat{D})^{-1}$, where $\hat{D}$ is the sample analog
of the gradient $D$
of moment conditions evaluated at $(\hat{\beta}, \hat{\sigma})$.


For the whole estimation procedure, I parallelize the calculation of the MSM objective
by splitting the tasks of solving all the games into several chunks. And I let each CPU
to solve a chunk of the games simultaneously to save the time of estimation.
